CC := gcc

CFLAGS := -fPIC
CFLAGS += -Wall
CFLAGS += -O2
CFLAGS += -g
CFLAGS += -I./

# xenaccess
CFLAGS += -D ENABLE_XEN
CFLAGS += -D XA_DEBUG
OBJECTS := xenaccess/linux_core.o
OBJECTS += xenaccess/linux_domain_info.o
OBJECTS += xenaccess/linux_memory.o
OBJECTS += xenaccess/linux_symbols.o
OBJECTS += xenaccess/windows_core.o
OBJECTS += xenaccess/windows_memory.o
OBJECTS += xenaccess/windows_process.o
OBJECTS += xenaccess/windows_symbols.o
OBJECTS += xenaccess/xa_cache.o
OBJECTS += xenaccess/xa_core.o
OBJECTS += xenaccess/xa_domain_info.o
OBJECTS += xenaccess/xa_error.o
OBJECTS += xenaccess/xa_file.o
OBJECTS += xenaccess/xa_memory.o
OBJECTS += xenaccess/xa_pretty_print.o
OBJECTS += xenaccess/xa_symbols.o
OBJECTS += xenaccess/xa_util.o

# vmps
LFLAGS := -lxenctrl
LFLAGS += -lxenstore
LFLAGS += -lebl
LFLAGS += -lelf
LFLAGS += -ldw
OBJECTS += config.o
OBJECTS += offset.o
OBJECTS += web.o
OBJECTS += log.o
OBJECTS += vmps.o
TARGET := vmps

default:
	@echo "compiling vmps (be patient)"
	$(MAKE) $(TARGET)
	@echo "vmps compiled"

%.o: %.c
	$(CC) -c $(CFLAGS) -o $@ $<

$(TARGET): $(OBJECTS)
	$(CC) $(CFLAGS) $(OBJECTS) $(LFLAGS) -o $@

clean:
	$(RM) -f $(OBJECTS)
	$(RM) -f $(TARGET)
	@echo "vmps cleaned"
